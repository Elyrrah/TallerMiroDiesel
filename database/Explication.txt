========== ========== ========== ========== ========== ========== ========== ========== ========== ========== ========== ========== ========== ==========
---------- ---------- ---------- ---------- ---------- -- TABLAS Y COLUMNAS DE LA BASE DE DATOS -- ---------- ---------- ---------- ---------- ----------
========== ========== ========== ========== ========== ========== ========== ========== ========== ========== ========== ========== ========== ==========

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- PAÍSES --- ---------- ---------- Define los países disponibles en el sistema ----------

id_pais → bigint (PK)                            Identificador único del país
nombre  → varchar(100)                           Nombre oficial del país
iso2    → char(2) UNIQUE                         Abreviación de dos letras (PY, BR, AR)
iso3    → char(3) UNIQUE                         Abreviación de tres letras (PRY, BRA, ARG)
activo  → boolean                                Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- DEPARTAMENTOS ------- ---------- División administrativa principal del país  ----------

id_departamento → bigint (PK)                    Identificador único del departamento
id_pais         → bigint (FK)                    Llave identificadora del país al que pertenece
nombre          → varchar(120)                   Nombre del departamento
activo          → boolean                        Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- DISTRITOS  ---------- ---------- División territorial dentro de un departamento -------

id_distrito      → bigint (PK)                   Identificador único del distrito
id_departamento  → bigint (FK)                   Llave identificadora del departamento al que pertenece
nombre           → varchar(120)                  Nombre del distrito
activo           → boolean                       Permite deshabilitar sin borrar datos
UNIQUE           → (id_departamento, nombre)     Evita duplicar distritos dentro del mismo departamento

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------- ----------
---------- ---------- LOCALIDADES --------- ---------- Barrios/zona/localidad dentro de un distrito ----------

id_localidad → bigint (PK)                       Identificador único de la localidad
id_distrito  → bigint (FK)                       Llave identificadora del distrito al que pertenece
nombre       → varchar(120)                      Nombre de la localidad
activo       → boolean                           Permite deshabilitar sin borrar datos
UNIQUE       → (id_distrito, nombre)             Evita duplicar localidades dentro del mismo distrito

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- CLIENTES - ---------- ---------- Tabla base de clientes --------- ---------- ----------

id_cliente     → bigint (PK)                     Identificador único del cliente
telefono       → varchar(30)                     Contacto principal (opcional)
email          → varchar(100)                    Contacto electrónico (opcional)
direccion      → varchar(255)                    Dirección libre (opcional)
id_distrito    → bigint (FK, nullable)           Distrito seleccionado (opcional)
id_localidad   → bigint (FK, nullable)           Localidad seleccionada (opcional)
activo         → boolean                         Permite deshabilitar sin borrar datos
fecha_creacion → timestamp                       Fecha de registro del cliente

Nota:
- Se permite cargar cliente con distrito o localidad.
- Si se elige localidad, el distrito se puede autocompletar (si luego agregás el trigger).
- En el esquema actual, ambos campos son opcionales (nullable), por lo que la validación de “al menos uno”
  depende de reglas de app o triggers si se activan.

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- CLIENTES_PERSONA ---- ---------- Datos cuando el cliente es una persona ---- ----------

id_cliente → bigint (PK y FK)                    Llave foránea del cliente
nombre     → varchar(120)                        Nombre de la persona
apellido   → varchar(120)                        Apellido de la persona
apodo      → varchar(30)                         Nombre interno o apodo (opcional)
activo     → boolean                             Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- CLIENTES_EMPRESA ---- ---------- Datos cuando el cliente es una empresa ---- ----------

id_cliente      → bigint (PK y FK)               Llave foránea del cliente
razon_social    → varchar(255)                   Razón social legal
nombre_fantasia → varchar(50)                    Nombre comercial o corto (opcional)
activo          → boolean                        Permite deshabilitar sin borrar datos

Nota:
- Un cliente no puede ser persona y empresa al mismo tiempo.
- Esto se controla automáticamente si activás el trigger de control.

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- TIPOS_DOCUMENTO ----- ---------- Tipos de documentos disponibles  ---------- ----------

id_tipo_documento → bigint (PK)                  Identificador único del tipo de documento
codigo            → varchar(20) UNIQUE            Código corto (CI, RUC, etc.)
nombre            → varchar(120)                 Nombre del documento
aplica_a          → varchar(10)                  PERSONA, EMPRESA o AMBOS
activo            → boolean                      Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- CLIENTE_DOCUMENTOS -- ---------- Documentos asociados a clientes  ---------- ----------

id_cliente_documento → bigint (PK)               Identificador único del documento
id_cliente           → bigint (FK)               Cliente al que pertenece
id_tipo_documento    → bigint (FK)               Tipo de documento
numero               → varchar(40)               Número del documento
principal            → boolean                   Indica si es el documento principal
activo               → boolean                   Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- MARCAS --- ---------- ---------- Marcas de vehículos - ---------- ---------- ----------

id_marca → bigint (PK)                           Identificador único de la marca
nombre   → varchar(50) UNIQUE                    Nombre de la marca
activo   → boolean                               Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- MODELOS -- ---------- ---------- Modelos asociados a marcas ----- ---------- ----------

id_modelo → bigint (PK)                          Identificador único del modelo
id_marca  → bigint (FK)                          Marca a la que pertenece
nombre    → varchar(50)                          Nombre del modelo
activo    → boolean                              Permite deshabilitar sin borrar datos

Nota:
- El modelo siempre debe pertenecer a la marca seleccionada (se valida en app o trigger si lo activás).

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- VEHÍCULOS  ---------- ---------- Vehículos ingresados al taller - ---------- ----------

id_vehiculo   → bigint (PK)                      Identificador único del vehículo
id_cliente    → bigint (FK)                      Cliente propietario
placa         → varchar(20) UNIQUE               Placa del vehículo
id_marca      → bigint (FK)                      Marca del vehículo
id_modelo     → bigint (FK, nullable)            Modelo del vehículo (opcional)
anio          → smallint                         Año del vehículo (opcional)
tipo_vehiculo → varchar(20)                      Tipo (CAMIÓN, CAMIONETA, TRACTOR, etc.)
observaciones → varchar(255)                     Notas adicionales (opcional)
activo        → boolean                          Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- COMPONENTES --------- ---------- Componentes traídos al taller -- ---------- ----------

id_componente   → bigint (PK)                    Identificador único del componente
id_cliente      → bigint (FK)                    Cliente propietario
tipo_componente → varchar(50)                    Tipo del componente
id_marca        → bigint (FK)                    Marca del componente
id_modelo       → bigint (FK)                    Modelo del componente
cantidad        → integer                        Cantidad entregada (DEFAULT 1)
observaciones   → varchar(255)                   Observaciones (opcional)
activo          → boolean                        Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- SERVICIOS  ---------- ---------- Servicios ofrecidos por el taller --------- ----------

id_servicio    → bigint (PK)                     Identificador único del servicio
codigo         → varchar(20) UNIQUE              Código corto del servicio
nombre         → varchar(120)                    Nombre del servicio
descripcion    → varchar(255)                    Descripción detallada (opcional)
precio_base    → numeric(14,0)                   Precio base en guaraníes
activo         → boolean                         Permite deshabilitar sin borrar datos
fecha_creacion → timestamp                       Fecha de alta del servicio

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- ROLES ---- ---------- ---------- Catálogo de roles del sistema  - ---------- ----------

id_rol         → bigint (PK)                     Identificador único del rol
codigo         → varchar(50) UNIQUE              Código del rol (DESARROLLADOR, ADMINISTRADOR, OPERADOR)
nombre         → varchar(120)                    Nombre visible del rol
descripcion    → varchar(255)                    Descripción (opcional)
activo         → boolean                         Permite deshabilitar sin borrar datos
fecha_creacion → timestamp                       Fecha de alta

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- PERMISOS - ---------- ---------- Catálogo de permisos/acciones  - ---------- ----------

id_permiso     → bigint (PK)                     Identificador único del permiso
codigo         → varchar(80) UNIQUE              Código del permiso (CATALOGOS.MARCA.LEER, etc.)
nombre         → varchar(120)                    Nombre visible del permiso
descripcion    → varchar(255)                    Descripción (opcional)
activo         → boolean                         Permite deshabilitar sin borrar datos
fecha_creacion → timestamp                       Fecha de alta

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- ROLES_PERMISOS ------ ---------- Relación N:M entre roles y permisos ------- ----------

id_rol         → bigint (PK y FK)                Rol al que se asigna el permiso
id_permiso     → bigint (PK y FK)                Permiso asignado
activo         → boolean                         Permite deshabilitar sin borrar datos
fecha_creacion → timestamp                       Fecha de asignación

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- USUARIOS - ---------- ---------- Usuarios del sistema  ---------- ---------- ----------

id_usuario        → bigint (PK)                  Identificador único del usuario
id_rol            → bigint (FK)                  Rol asignado (1 usuario = 1 rol)
nombre            → varchar(50)                  Nombre
apellido          → varchar(50)                  Apellido
nombre_usuario    → varchar(50) UNIQUE           Nombre visible en la app / login
email             → varchar(100) UNIQUE          Email (login)
password_hash     → varchar(255)                 Contraseña encriptada
id_tipo_documento → bigint (FK)                  Tipo de documento
numero_documento  → varchar(40)                  Número del documento
fecha_nacimiento  → date                         Fecha de nacimiento (opcional)
activo            → boolean                      Permite deshabilitar sin borrar datos
fecha_creacion    → timestamp                    Fecha de alta

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- ORDENES_TRABAJO ----- ---------- Orden principal del trabajo ---- ---------- ----------

id_orden_trabajo      → bigint (PK)              Identificador único
numero_orden          → varchar(30) UNIQUE       Número generado automáticamente (OT-YYYY-MM-001)
id_usuario            → bigint (FK)              Usuario que registra la orden
id_cliente            → bigint (FK)              Cliente
tipo_ingreso          → enum                     VEHICULO o COMPONENTE (ENUM en tu schema)
id_vehiculo           → bigint (FK, nullable)    Vehículo asociado (si aplica)
id_componente         → bigint (FK, nullable)    Componente asociado (si aplica)
fecha_ingreso         → timestamp                Fecha de ingreso
problema_reportado    → varchar(255)             Problema informado por el cliente (opcional)
observaciones_ingreso → varchar(255)             Observaciones internas (opcional)
estado                → enum                     Estado de la orden (ENUM en tu schema)
fecha_entrega         → timestamp                Fecha de entrega al cliente (opcional)
total_estimado        → numeric(14,0)            Total calculado (DEFAULT 0)
fecha_fin             → timestamp                Fecha de finalización del trabajo (opcional)
activo                → boolean                  Permite deshabilitar sin borrar datos
fecha_creacion        → timestamp                Fecha de creación

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- ORDEN_TRABAJO_DETALLES --------- Detalles del trabajo realizado - ---------- ----------

id_detalle       → bigint (PK)                   Identificador único del detalle
id_orden_trabajo → bigint (FK)                   Orden a la que pertenece
id_servicio      → bigint (FK)                   Servicio realizado
descripcion      → varchar(255)                  Descripción adicional (opcional)
cantidad         → integer                       Cantidad del servicio (DEFAULT 1)
precio_unitario  → numeric(14,0)                 Precio aplicado (puede completarse automáticamente)
subtotal         → numeric(14,0) (calculado)     cantidad × precio_unitario (GENERATED)
observaciones    → varchar(255)                  Observaciones del detalle (opcional)
garantia_meses   → smallint                      Meses de garantía (opcional)
garantia_dias    → smallint                      Días de garantía (opcional)
garantia_desde   → date                          Inicio de la garantía (opcional)
garantia_hasta   → date                          Fin de la garantía (opcional)
activo           → boolean                       Permite deshabilitar sin borrar datos
fecha_creacion   → timestamp                     Fecha de registro

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- PLANES_PAGO --------- ---------- Planes de pago, como cuotas o contado ----- ----------

id_plan_pago      → bigint (PK)                  Identificador único
id_orden_trabajo  → bigint (FK)                  Orden asociada
tipo_plan         → enum                         CONTADO, CUOTAS, etc. (ENUM en tu schema)
estado            → enum                         Estado del plan (ENUM en tu schema)
fecha_inicio      → date                         Inicio del plan (DEFAULT CURRENT_DATE)
fecha_vencimiento → date                         Fin del plan (opcional)
monto_cuota       → numeric(14,0)                Monto por cuota (DEFAULT 0)
dia_pago          → smallint                     Día de pago (opcional)
cantidad_cuotas   → smallint                     Cantidad total (DEFAULT 1)
observaciones     → varchar(255)                 Observaciones (opcional)
activo            → boolean                      Permite deshabilitar sin borrar datos
fecha_creacion    → timestamp                    Fecha de alta

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- PLANES_PAGO_EVENTOS - --------- Eventos del plan de pago -------- ---------- ----------

id_evento        → bigint (PK)                   Identificador único
id_plan_pago     → bigint (FK)                   Plan asociado
fecha_evento     → timestamp                     Fecha del evento (DEFAULT now())
tipo_evento      → enum                         Tipo de evento (ENUM en tu schema)
fecha_compromiso → date                          Fecha comprometida (opcional)
monto_compromiso → numeric(14,0)                 Monto comprometido (opcional)
detalle          → varchar(255)                  Observaciones (opcional)
activo           → boolean                       Permite deshabilitar sin borrar datos

---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
---------- ---------- PAGOS ---- ---------- ---------- Pagos realizados por los clientes --------- ----------

id_pago          → bigint (PK)                   Identificador único
id_usuario       → bigint (FK)                   Usuario que registra el pago
id_orden_trabajo → bigint (FK)                   Orden asociada
id_plan_pago     → bigint (FK, nullable)         Plan de pago (si aplica)
fecha_pago       → timestamp                     Fecha del pago (DEFAULT now())
monto            → numeric(14,0)                 Monto abonado (DEFAULT 0)
forma_pago       → enum                         EFECTIVO, TRANSFERENCIA, etc. (ENUM en tu schema)
referencia       → varchar(80)                   Referencia del pago (opcional)
observaciones    → varchar(255)                  Observaciones (opcional)
activo           → boolean                       Permite deshabilitar sin borrar datos
fecha_creacion   → timestamp                     Fecha de registro (DEFAULT now())
